{{ if eq .chezmoi.os "linux" -}}
#!/bin/sh

if snap list | grep -q "firefox"; then
  echo "Firefox is already installed"
else
  echo "Installing Firefox..."

  sudo snap install firefox
fi

# valet-linux-plus
composer global show "cpriego/valet-linux" > /dev/null 2>%1
if [ $? -eq 0 ]; then
    echo "valet-linux-plus is already installed"
else
  echo "Installing valet-linux-plus..."
  sudo apt-get install curl libnss3-tools jq xsel openssl ca-certificates
  composer global require cpriego/valet-linux
  sudo add-apt-repository ppa:ondrej/php
fi

# Utilities
if ! dpkg -l | grep -q "xclip"; then
  echo "Installing xclip ..."

  sudo apt install xclip
else
  echo "xclip is already installed."
fi


if ! dpkg -l | grep -q "libfuse2"; then
  echo "Installing libfuse2..."

sudo apt install libfuse2
else
  echo "libfuse2 is already installed."
fi

if ! dpkg -l | grep -q "variety"; then
  echo "Installing Variety wallpaper manager..."
  sudo apt install variety
else
  echo "Variety is already installed."
fi

if ! dpkg -l | grep -q "wireguard"; then
  echo "Installing Wireguard VPN client..."
  sudo apt install wireguard systemd-resolved
  # Enable and start systemd-resolved service
  sudo systemctl enable systemd-resolved
  sudo systemctl start systemd-resolved
  # Configure system to use systemd-resolved
  sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
else
  echo "Wireguard is already installed."
fi

# Set up Wireguard configuration from 1Password if it doesn't exist
echo "Sudo access is required to check Wireguard configuration."
if ! test -f "/etc/wireguard/wg0.conf"; then
  sudo mkdir -p /etc/wireguard
  WIREGUARD_CONF=$(op read "op://private/wiregard-conf/kdg.conf")
  echo "Setting up Wireguard configuration..."
  sudo mkdir -p /etc/wireguard
  WIREGUARD_CONF=$(op read "op://private/wiregard-conf/kdg.conf")

  if [ $? -eq 0 ]; then
    echo "$WIREGUARD_CONF" | sudo tee /etc/wireguard/wg0.conf > /dev/null
    sudo chmod 600 /etc/wireguard/wg0.conf
    echo "Wireguard configuration installed successfully."
  else
    echo "Failed to fetch Wireguard configuration from 1Password."
  fi
else
  echo "Wireguard configuration already exists."
fi

# AI Tools
which ollama > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "Installing Ollama..."
  curl https://ollama.ai/install.sh | sh
else
  echo "Ollama is already installed."
fi

# Setup Ollama Web UI
if ! docker ps -a | grep -q "open-webui"; then
  echo "Setting up Ollama Web UI..."
  docker run -d \
    -p 3000:8080 \
    --gpus all \
    -v ollama:/root/.ollama \
    -v open-webui:/app/backend/data \
    --name open-webui \
    --restart always \
    --network=host \
  -e WEBUI_AUTH=False \
    ghcr.io/open-webui/open-webui:ollama
  echo "Ollama Web UI is now available at http://localhost:3000"
else
  echo "Ollama Web UI is already running."
fi

# DevTools


if ! snap list | grep -q "postman"; then
  echo "Installing postman..."
  sudo snap install postman 
else
  echo "Postman is already installed."
fi

if ! snap list | grep -q "ngrok"; then
  echo "Installing ngrok..."
  sudo snap install ngrok
else
  echo "ngrok is already installed."
fi


which stripe > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "Installing Stripe CLI..."
  curl -s https://packages.stripe.dev/api/security/keypair/stripe-cli-gpg/public | gpg --dearmor | sudo tee /usr/share/keyrings/stripe.gpg
  echo "deb [signed-by=/usr/share/keyrings/stripe.gpg] https://packages.stripe.dev/stripe-cli-debian-local stable main" | sudo tee -a /etc/apt/sources.list.d/stripe.list
  sudo apt update
  sudo apt install stripe

else
  echo "Stripe CLI is already installed."
fi

# Browsers
if ! dpkg -l | grep -q "google-chrome-stable"; then
  echo "Installing Google Chrome..."
  wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
  sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
  sudo apt update
  sudo apt install google-chrome-stable
else
  echo "Google Chrome is already installed."
fi

if ! flatpak list | grep -q "app.zen_browser.zen"; then
  echo "Installing Zen Browser..."
  flatpak install flathub app.zen_browser.zen
  flatpak run app.zen_browser.zen
else
  echo "Zen Browser is already installed."
fi

# Password Manager
if ! dpkg -l | grep -q "1password"; then
  echo "Installing 1Password..."
  # Add the key for the 1Password apt repository
  curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/keyrings/1password-archive-keyring.gpg
  # Add the 1Password apt repository
  echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/amd64 stable main' | sudo tee /etc/apt/sources.list.d/1password.list
  # Add the debsig-verify policy
  sudo mkdir -p /etc/debsig/policies/AC2D62742012EA22/
  curl -sS https://downloads.1password.com/linux/debian/debsig/1password.pol | sudo tee /etc/debsig/policies/AC2D62742012EA22/1password.pol
  sudo mkdir -p /usr/share/debsig/keyrings/AC2D62742012EA22
  curl -sS https://downloads.1password.com/linux/keys/1password.asc | sudo gpg --dearmor --output /usr/share/debsig/keyrings/AC2D62742012EA22/debsig.gpg
  # Install 1Password
  sudo apt update && sudo apt install 1password 1password-cli
else
  echo "1Password is already installed."
fi

# Terminal
if ! dpkg -l | grep -q "ghostty"; then
  echo "Installing Ghostty..."
  wget -O ghostty.deb https://github.com/mkasberg/ghostty-ubuntu/releases/download/1.0.1-0-ppa4/ghostty_1.0.1-0.ppa4_amd64_24.10.deb
  sudo apt install ./ghostty.deb
  rm ghostty.deb
else
  echo "Ghostty is already installed."
fi

# Install lazygit
if ! dpkg -l | grep -q "lazygit"; then
  echo "Installing lazygit..."
  LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
  curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
  tar xf lazygit.tar.gz lazygit
  sudo install lazygit /usr/local/bin
  rm lazygit.tar.gz lazygit
else
  echo "lazygit is already installed."
fi

# Install Zellij
if ! dpkg -l | grep -q "zellij"; then
  echo "Installing Zellij..."
  ZELLIJ_VERSION=$(curl -s "https://api.github.com/repos/zellij-org/zellij/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
  curl -Lo zellij.deb "https://github.com/zellij-org/zellij/releases/latest/download/zellij-x86_64-unknown-linux-musl.deb"
  sudo dpkg -i zellij.deb
  rm zellij.deb
else
  echo "Zellij is already installed."
fi

# Communication tools

if ! snap list | grep -q "slack"; then
  sudo snap install slack
else
  echo "Slack is already installed."
fi

if ! snap list | grep -q "discord"; then
  sudo snap install discord 
else
  echo "Discord is already installed."
fi

# Check for NVM installation
if [ -d "$HOME/.nvm" ]; then
  echo "NVM is already installed."
else
  echo "Installing NVM..."
  # Install NVM
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
  
  # Load NVM immediately for the rest of the script
  export NVM_DIR="$HOME/.nvm"
  [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
  
  # Install latest LTS version of Node
  nvm install --lts
  nvm use --lts
fi

# Check for npm installation
if command -v npm >/dev/null 2>&1; then
  echo "npm is already installed"
else
  echo "Installing npm..."
  sudo apt update
  sudo apt install -y npm
fi

# No package manager available
which freeze > /dev/null 2>%1
if [ $? -eq 0 ]; then
  echo "freeze already installed."
else
  echo "Freeze is not installed. Opening browser for download..."
  xdg-open https://github.com/charmbracelet/freeze/releases & disown
fi


{{ end -}}


{{ if eq .chezmoi.os "darwin" -}}
#!/bin/sh

# Install 1Password
if ! brew list --cask | grep -q "1password"; then
  echo "Installing 1Password..."
  brew install --cask 1password 1password-cli
else
  echo "1Password is already installed."
fi

# Install Google Chrome
if ! brew list --cask | grep -q "google-chrome"; then
  echo "Installing Google Chrome..."
  brew install --cask google-chrome
else
  echo "Google Chrome is already installed."
fi
# Install Zen Browser
if ! test -d "/Applications/Zen.app"; then
  echo "Installing Zen Browser..."
  curl -L "https://objects.githubusercontent.com/github-production-release-asset-2e65be/778556932/07bb19d8-1960-4589-9d79-c290c0b6795d?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=releaseassetproduction%2F20250131%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20250131T071117Z&X-Amz-Expires=300&X-Amz-Signature=271b6858c0614b280560b1b2f2df0d5c9ae074b8bb45b982cef68c5aa4ac953a&X-Amz-SignedHeaders=host&response-content-disposition=attachment%3B%20filename%3Dzen.macos-universal.dmg&response-content-type=application%2Foctet-stream" -o zen.dmg
  hdiutil attach zen.dmg
  cp -R "/Volumes/Zen/Zen.app" /Applications/
  hdiutil detach "/Volumes/Zen"
  rm zen.dmg
else
  echo "Zen Browser is already installed."
fi

# Install Setapp
if ! brew list --cask | grep -q "setapp"; then
  echo "Installing Setapp..."
  brew install --cask setapp
else
  echo "Setapp is already installed."
fi

# Install Ghostty
if ! brew list --cask | grep -q "ghostty"; then
  echo "Installing Ghostty..."
  brew install --cask ghostty
else
  echo "Ghostty is already installed."
fi

# Install Syncthing
if ! brew list | grep -q "syncthing"; then
  echo "Installing Syncthing..."
  brew install syncthing
else
  echo "Syncthing is already installed."
fi

# Install Microsoft Teams
if ! brew list --cask | grep -q "microsoft-teams"; then
  echo "Installing Microsoft Teams..."
  brew install --cask microsoft-teams
else
  echo "Microsoft Teams is already installed."
fi

# Check for Wireguard
if ! test -d "/Applications/WireGuard.app"; then
  echo "Wireguard is not installed. Opening Mac App Store..."
  open "https://apps.apple.com/us/app/wireguard/id1451685025?ls=1&mt=12"
else
  echo "Wireguard is already installed."
fi

# Install lazygit
if ! brew list | grep -q "lazygit"; then
  echo "Installing lazygit..."
  brew install lazygit
else
  echo "lazygit is already installed."
fi

# Install Raycast
if ! brew list --cask | grep -q "raycast"; then
  echo "Installing Raycast..."
  brew install --cask raycast
else
  echo "Raycast is already installed."
fi

# Install npm
if ! brew list | grep -q "npm"; then
  echo "Installing npm..."
  brew install npm
else
  echo "npm is already installed."
fi

# Install Zellij
if ! brew list | grep -q "zellij"; then
  echo "Installing Zellij..."
  brew install zellij
else
  echo "Zellij is already installed."
fi

# Install Slack
if ! brew list --cask | grep -q "slack"; then
  echo "Installing Slack..."
  brew install --cask slack
else
  echo "Slack is already installed."
fi

{{ end -}}

npm list -g blade-formatter > /dev/null 2>%1
if [ $? -eq 0 ]; then
  echo "blade-formatter already installed"
else
  echo "installing blade-formatter..."
  npm install -g blade-formatter
fi

npm list -g prettier  > /dev/null 2>%1
if [ $? -eq 0 ]; then
  echo "prettier already installed"
else
  echo "installing prettier..."
  npm install -g prettier 
  fi
  
  npm list -g yarn > /dev/null 2>%1
  if [ $? -eq 0 ]; then
    echo "yarn already installed"
  else
    echo "installing yarn..."
    npm install -g yarn
fi

